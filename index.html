<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>æœƒè€ƒæˆ°å£«ï¼šç¥å¥‡è£œçµ¦ç¸½éƒ¨ v2.0 å…¸è—ç‰ˆ</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f4f9; padding: 20px; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1, h2 { color: #333; text-align: center; }
        .stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; background: #eee; padding: 15px; border-radius: 10px; margin-bottom: 20px; font-weight: bold; text-align: center; }
        .menu { display: flex; gap: 5px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; }
        button { padding: 10px 12px; cursor: pointer; border: none; border-radius: 8px; background: #6c5ce7; color: white; transition: 0.3s; font-size: 0.9em; }
        button:hover { background: #a29bfe; }
        .section { display: none; }
        .active { display: block; }
        .item-card { border: 1px solid #ddd; padding: 10px; margin: 8px 0; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
        .tag { font-size: 0.7em; padding: 2px 5px; border-radius: 4px; color: white; margin-left: 5px; }
        .tag-food { background: #fab1a0; color: #d63031; }
        .tag-special { background: #ffd700; color: #000; font-weight: bold; }
        .status-msg { color: #e74c3c; font-weight: bold; text-align: center; min-height: 1.5em; margin-bottom: 10px; }
        .inventory-list { background: #f9f9f9; padding: 10px; border-radius: 10px; min-height: 50px; border: 1px dashed #ccc; }
        /* ç¦®åŒ…å‹•ç•« */
        @keyframes gift-pop { 0% { transform: scale(0.5); } 100% { transform: scale(1); } }
        .gift-box { background: #fff3f3; border: 2px dashed #ff7675; padding: 15px; border-radius: 10px; text-align: center; animation: gift-pop 0.5s; }
    </style>
</head>
<body>

<div class="container">
    <h1>ç¥å¥‡è£œçµ¦ç¸½éƒ¨</h1>
    <div id="status-display" class="status-msg">æ­¡è¿å›ä¾†ï¼Œåº—é•·ï¼</div>

    <div class="stats">
        <div>ğŸ’° é‡‘å¹£<br><span id="money">500</span></div>
        <div>âœ¨ é¡å€¼<br><span id="beauty">80</span>/100</div>
        <div>ğŸ” é£½é£Ÿ<br><span id="hunger">70</span>/100</div>
    </div>

    <div class="menu">
        <button onclick="showSection('work')">è³ºéŒ¢</button>
        <button onclick="showSection('shop')">å•†åº—</button>
        <button onclick="showSection('inventory')">ğŸ’ èƒŒåŒ…</button>
        <button onclick="showSection('diary')">è¯çµ¡ç°¿</button>
        <button onclick="checkIn()" id="checkin-btn" style="background:#2ecc71">ğŸ“… ç°½åˆ°</button>
        <button onclick="toggleUpdateModal()">âœ¨ æ—¥èªŒ</button>
        <button onclick="clearSave()" style="background:#e74c3c">é‡ç½®</button>
    </div>

    <div id="gift-area"></div>

    <div id="work" class="section active" style="text-align:center;">
        <button onclick="clickWork()" style="padding: 20px; font-size: 1.1em; background: #ff7675; width: 100%; font-weight: bold; margin-bottom:15px;">æ‰“å·¥ (é»æ“Š +10, é£½é£Ÿ -1)</button>
        <div style="background: #fffbe6; padding: 10px; border-radius: 10px; border: 1px solid #ffe58f;">
            <h3>ğŸ¤– è‡ªå‹•åŒ–è¨­æ–½</h3>
            <div class="item-card"><span>å·¥è®€ç”Ÿ (+1/ç§’)</span><button onclick="buyAuto('helper', 300)">$300</button></div>
            <div class="item-card"><span>è‡ªå‹•çµå¸³æ©Ÿ (+5/ç§’)</span><button onclick="buyAuto('machine', 1000)">$1000</button></div>
        </div>
    </div>

    <div id="shop" class="section">
        <h2>ç¥å¥‡å•†åº—</h2>
        <div class="item-card"><span>æ‡‰æ€¥åå¸ <span class="tag tag-food">é£½é£Ÿ+20</span></span><button onclick="buyItem('æ‡‰æ€¥åå¸', 50, 'food', 20)">$50</button></div>
        <div class="item-card"><span>Nature Face å™´éœ§ <span class="tag tag-skin">ä¿é¤Š</span></span><button onclick="buyItem('Nature Face å™´éœ§', 150, 'skin', 8)">$150</button></div>
        <div class="item-card"><span>é›ªèŠ™è˜­å«©ç™½åŒ–å¦æ°´ <span class="tag tag-skin">ä¿é¤Š</span></span><button onclick="buyItem('é›ªèŠ™è˜­åŒ–å¦æ°´', 120, 'skin', 10)">$120</button></div>
        <div class="item-card"><span>æ›¼ç§€é›·æ•¦èª¿ç†æ°´ <span class="tag tag-skin">ä¿é¤Š</span></span><button onclick="buyItem('èª¿ç†æ°´', 120, 'skin', 8)">$120</button></div>
        <div class="item-card"><span>é­…æƒ‘å£ç´… <span class="tag tag-makeup">å½©å¦</span></span><button onclick="buyItem('é­…æƒ‘å£ç´…', 200, 'makeup', 15)">$200</button></div>
        <div class="item-card"><span>é›ªèŠ™è˜­å¸å¦æ°´</span><button onclick="buyItem('å¸å¦æ°´', 150, 'clean', 0)">$150</button></div>
        <div class="item-card"><span>å¯ç«‹ä¿¡ç—˜ç—˜å‡è† </span><button onclick="buyItem('ç—˜ç—˜è†', 200, 'clean', 0)">$200</button></div>
    </div>

    <div id="inventory" class="section">
        <h2>æˆ‘çš„èƒŒåŒ…</h2>
        <div id="inventory-display" class="inventory-list"></div>
    </div>

    <div id="diary" class="section">
        <h2>ä»Šæ—¥è¯çµ¡ç°¿</h2>
        <textarea id="diary-box" style="width:100%; height:120px; padding:10px; border-radius:10px;" placeholder="å¯«ä¸‹å¿ƒæƒ…..."></textarea>
    </div>
</div>

<div id="overlay" onclick="toggleUpdateModal()"></div>
<div id="updateModal">
    <h3>ğŸš€ v2.0 å…¸è—åŠŸèƒ½å…¨é¢æ‰¾å›</h3>
    <hr>
    <ul>
        <li>[æ‰¾å›] <strong>é–‹å­¸å¤§ç¦®åŒ…</strong>ï¼šæ–°é€²åº—é•·å¿…å¾—ç¥è£ï¼</li>
        <li>[æ‰¾å›] <strong>æ¯æ—¥ç°½åˆ°</strong>ï¼šæ¯å¤©é ˜å–é‡‘å¹£çå‹µã€‚</li>
        <li>[ä¿®æ­£] <strong>èƒŒåŒ…ç³»çµ±</strong>ï¼šç‰©å“è³¼è²·å¾Œæ­£ç¢ºå­˜æ”¾ã€‚</li>
        <li>[å„ªåŒ–] <strong>ç©©å®šå­˜æª”</strong>ï¼šç°½åˆ°ç‹€æ…‹èˆ‡ç¦®åŒ…é ˜å–ç´€éŒ„ä¹Ÿæœƒä¿å­˜ã€‚</li>
    </ul>
    <button onclick="toggleUpdateModal()">é—œé–‰</button>
</div>

<script>
    let state = { 
        money: 500, 
        beauty: 80, 
        hunger: 70, 
        autoIncome: 0, 
        isDirty: false, 
        hasAcne: false, 
        inventory: [],
        hasReceivedGift: false,
        lastCheckIn: "" 
    };

    function saveGame() { localStorage.setItem('magicShopSave_v2.0', JSON.stringify(state)); }
    function loadGame() {
        const saved = localStorage.getItem('magicShopSave_v2.0');
        if (saved) { state = Object.assign(state, JSON.parse(saved)); }
    }
    function clearSave() { if(confirm("ç¢ºå®šé‡ç½®ï¼Ÿ")) { localStorage.removeItem('magicShopSave_v2.0'); location.reload(); } }

    setInterval(() => {
        state.money += state.autoIncome;
        if (state.hunger > 0) state.hunger -= 0.5;
        else state.beauty = Math.max(0, state.beauty - 1);
        saveGame(); updateUI();
    }, 1000);

    // --- ç°½åˆ°åŠŸèƒ½ ---
    function checkIn() {
        const today = new Date().toLocaleDateString();
        if (state.lastCheckIn === today) {
            alert("ä»Šå¤©å·²ç¶“é ˜éç°½åˆ°çå‹µäº†å–”ï¼");
        } else {
            state.money += 100;
            state.lastCheckIn = today;
            saveGame();
            updateUI("ç°½åˆ°æˆåŠŸï¼ç²å¾— $100 é‡‘å¹£");
        }
    }

    // --- å¤§ç¦®åŒ…åŠŸèƒ½ ---
    function receiveGift() {
        state.money += 300;
        state.inventory.push({ name: "é–‹å­¸ç‰¹ä¾›åå¸", type: "food", power: 50 });
        state.inventory.push({ name: "é–‹å­¸ç¥ä»™æ°´", type: "skin", power: 20 });
        state.hasReceivedGift = true;
        document.getElementById('gift-area').innerHTML = "";
        saveGame();
        updateUI("ç¦®åŒ…é ˜å–æˆåŠŸï¼é‡‘å¹£+$300ï¼Œç‰©è³‡å·²å…¥åº«ã€‚");
    }

    function checkGift() {
        if (!state.hasReceivedGift) {
            document.getElementById('gift-area').innerHTML = `
                <div class="gift-box">
                    <h3>ğŸ é–‹å­¸æ‡‰æ´å¤§ç¦®åŒ…</h3>
                    <p>åº—é•·è¾›è‹¦äº†ï¼é€ä½ é‡‘å¹£èˆ‡ç¥ç´šç‰©è³‡ã€‚</p>
                    <button onclick="receiveGift()" style="background:#ff7675">ç«‹åˆ»é ˜å–</button>
                </div>
            `;
        }
    }

    // --- åŸºç¤é‚è¼¯ ---
    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if (id === 'inventory') renderInventory();
        if (state.isDirty) checkAcneRisk();
    }

    function toggleUpdateModal() {
        const s = document.getElementById('updateModal').style.display;
        document.getElementById('updateModal').style.display = (s === 'block' ? 'none' : 'block');
        document.getElementById('overlay').style.display = (s === 'block' ? 'none' : 'block');
    }

    function buyItem(name, price, type, power) {
        if (state.money < price) { alert("éŒ¢ä¸å¤ ï¼"); return; }
        state.money -= price;
        state.inventory.push({ name, type, power });
        saveGame();
        updateUI("å·²å°‡ " + name + " æ”¾å…¥èƒŒåŒ…");
    }

    function useItem(index) {
        const item = state.inventory[index];
        if (item.type === 'food') state.hunger = Math.min(100, state.hunger + item.power);
        else if (item.name === 'å¸å¦æ°´') state.isDirty = false;
        else if (item.name === 'ç—˜ç—˜è†') {
            if (state.hasAcne) { state.hasAcne = false; state.beauty = Math.min(100, state.beauty + 15); }
            else { alert("æ²’ç—˜ç—˜ä¸ç”¨æ“¦"); return; }
        } else {
            state.beauty = Math.min(100, state.beauty + item.power);
            if (item.type === 'makeup') state.isDirty = true;
        }
        state.inventory.splice(index, 1);
        saveGame(); renderInventory(); updateUI("ä½¿ç”¨äº† " + item.name);
    }

    function renderInventory() {
        const div = document.getElementById('inventory-display');
        div.innerHTML = state.inventory.length === 0 ? "èƒŒåŒ…ç©ºç©ºå¦‚ä¹Ÿ" : "";
        state.inventory.forEach((item, index) => {
            div.innerHTML += `<div class="item-card"><span>${item.name}</span><button onclick="useItem(${index})" style="background:#2ecc71">ä½¿ç”¨</button></div>`;
        });
    }

    function clickWork() {
        if (state.hunger < 1) { alert("é¤“æ‰äº†ï¼"); return; }
        state.money += 10; state.hunger -= 1; updateUI("æ‰“å·¥ä¸­...");
    }

    function buyAuto(type, price) {
        if (state.money >= price) {
            state.money -= price;
            state.autoIncome += (type === 'helper' ? 1 : 5);
            updateUI("è‡ªå‹•è¨­å‚™å·²å‡ç´šï¼");
        } else alert("éŒ¢ä¸å¤ ï¼");
    }

    function checkAcneRisk() {
        if (state.isDirty && Math.random() < 0.2) {
            state.hasAcne = true; state.beauty = Math.max(0, state.beauty - 10);
            updateUI("âš ï¸ é•·ç—˜ç—˜äº†ï¼");
        }
    }

    function updateUI(msg) {
        document.getElementById('money').innerText = Math.floor(state.money);
        document.getElementById('beauty').innerText = Math.floor(state.beauty);
        document.getElementById('hunger').innerText = Math.floor(state.hunger);
        document.getElementById('status-display').innerText = msg || `è‡ªå‹•ç”¢é‡‘ï¼š${state.autoIncome}/ç§’`;
        if (state.hasAcne) document.getElementById('status-display').innerText += " [ğŸ¦  ç—˜ç—˜]";
    }

    loadGame(); 
    checkGift();
    updateUI();
</script>
</body>
</html>
