<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>æœƒè€ƒæˆ°å£«ï¼šç¥å¥‡è£œçµ¦ç¸½éƒ¨ v3.5 ç»ç’ƒæ“¬æ…‹ç‰ˆ</title>
    <style>
        /* ç»ç’ƒæ“¬æ…‹èˆ‡å…¨å±€ç¾åŒ– */
        :root {
            --glass: rgba(255, 255, 255, 0.25);
            --blur: blur(12px);
            --border: rgba(255, 255, 255, 0.3);
        }
        body { 
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif; 
            background: linear-gradient(135deg, #ffafbd 0%, #ffc3a0 100%); 
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        .container { 
            max-width: 600px; 
            width: 100%;
            background: var(--glass); 
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border: 1px solid var(--border);
            padding: 25px; 
            border-radius: 25px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.1); 
        }
        h1 { text-align: center; color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        
        /* è† å›Šç‹€æ…‹æ¬„ */
        .stats { 
            display: grid; 
            grid-template-columns: 1fr 1fr 1fr; 
            gap: 15px; 
            background: rgba(255, 255, 255, 0.3); 
            padding: 15px; 
            border-radius: 50px; /* è† å›Šæ„Ÿ */
            margin-bottom: 20px; 
            font-weight: bold; 
            text-align: center;
            border: 1px solid var(--border);
        }
        .rank-display { text-align: center; color: #fff; font-weight: bold; margin-bottom: 10px; background: rgba(108, 92, 231, 0.6); border-radius: 20px; padding: 5px; }
        
        .menu { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; }
        button { 
            padding: 10px 18px; 
            cursor: pointer; 
            border: none; 
            border-radius: 12px; 
            background: #6c5ce7; 
            color: white; 
            transition: 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        button:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
        
        .section { display: none; background: rgba(255, 255, 255, 0.4); padding: 15px; border-radius: 15px; }
        .active { display: block; }
        .item-card { border-bottom: 1px solid rgba(255,255,255,0.3); padding: 12px 0; display: flex; justify-content: space-between; align-items: center; }
        
        .tag { font-size: 0.75em; padding: 3px 8px; border-radius: 6px; color: white; margin-left: 5px; }
        .tag-food { background: #ff7675; }
        .tag-skin { background: #55efc4; color: #000; }
        .tag-makeup { background: #fdcb6e; color: #000; }
        
        .status-msg { color: #d63031; font-weight: bold; text-align: center; min-height: 1.5em; margin-bottom: 10px; }
        textarea { width: 100%; height: 120px; padding: 10px; border-radius: 15px; border: none; background: rgba(255,255,255,0.5); resize: none; box-sizing: border-box; }
        hr { border: 0; border-top: 1px solid rgba(255,255,255,0.5); margin: 20px 0; }
        h3 { color: #2d3436; font-size: 1.1em; margin-top: 0; }
    </style>
</head>
<body>

<div class="container">
    <h1>ç¥å¥‡è£œçµ¦ç¸½éƒ¨</h1>
    <div id="beauty-rank" class="rank-display">é ­éŠœï¼šè¼‰å…¥ä¸­...</div>

    <div style="background: rgba(255,255,255,0.3); padding: 12px; border-radius: 15px; margin-bottom: 15px;">
        <strong>ğŸ“¢ å…¬å‘Šï¼š</strong> <span id="display-note">æ­¡è¿åº—é•·ï¼</span>
        <button onclick="toggleAdmin()" style="padding:2px 5px; background:none; color:#636e72; float:right;">âš™ï¸</button>
        <div id="admin-panel" style="display:none; margin-top:10px;">
            <input type="text" id="admin-user" placeholder="å¸³è™Ÿ" style="width:45%">
            <input type="password" id="admin-pass" placeholder="å¯†ç¢¼" style="width:45%">
            <textarea id="edit-note" placeholder="ä¿®æ”¹å…¬å‘Š..." style="height:40px; margin-top:5px;"></textarea>
            <button onclick="updateNote()" style="background:#2ecc71; width:100%; margin-top:5px;">ç™¼å¸ƒå…¬å‘Š</button>
        </div>
    </div>

    <div id="gift-area"></div>

    <div class="stats">
        <div>ğŸ’° é‡‘å¹£<br><span id="money">--</span></div>
        <div>âœ¨ é¡å€¼<br><span id="beauty">--</span></div>
        <div>ğŸ” é£½é£Ÿ<br><span id="hunger">--</span></div>
    </div>

    <div style="text-align:center; font-size:0.8em; margin-bottom:15px; color: #2d3436;">
        ğŸš¿ <span id="last-wash-display">--</span> | ğŸ§´ ç‹€æ…‹ï¼š<span id="skin-status-display">è‰¯å¥½</span>
    </div>

    <div class="menu">
        <button onclick="showSection('work')">è³ºéŒ¢</button>
        <button onclick="showSection('shop')">å•†åº—</button>
        <button onclick="showSection('inventory')">ğŸ’ èƒŒåŒ…</button>
        <button onclick="showSection('diary')">è¯çµ¡ç°¿</button>
        <button onclick="washHair()" style="background:#0984e3;">ğŸš¿ æ´—é ­</button>
        <button onclick="checkIn()">ğŸ“… ç°½åˆ°</button>
    </div>

    <div id="status-display" class="status-msg"></div>

    <div id="work" class="section active">
        <button onclick="clickWork()" style="width:100%; padding:30px; background:#ff7675; border-radius:20px; font-weight:bold; font-size:1.2em;">ğŸ’ª åŠªåŠ›æ‰“å·¥è³ºéŒ¢ (+10)</button>
    </div>

    <div id="shop" class="section">
        <h3>ğŸ± é£Ÿå“ä¾›æ‡‰å€</h3>
        <div class="item-card"><span>å¾¡é£¯ç³° <span class="tag tag-food">+35</span></span><button onclick="buyItem('å¾¡é£¯ç³°', 80, 'food', 35)">$80</button></div>
        <div class="item-card"><span>å°å¼æ’éª¨é£¯ <span class="tag tag-food">+80</span></span><button onclick="buyItem('æ’éª¨é£¯', 250, 'food', 80)">$250</button></div>
        
        <hr>
        <h3>ğŸ§´ è­·è†šä¿é¤Šå€</h3>
        <div class="item-card"><span>é›ªèŠ™è˜­åŒ–å¦æ°´ <span class="tag tag-skin">+10é¡å€¼</span></span><button onclick="buyItem('é›ªèŠ™è˜­åŒ–å¦æ°´', 120, 'skin', 10)">$120</button></div>
        <div class="item-card"><span>Nature Face å™´éœ§ <span class="tag tag-skin">+8é¡å€¼</span></span><button onclick="buyItem('Nature Face å™´éœ§', 150, 'skin', 8)">$150</button></div>
        <div class="item-card"><span>é›ªèŠ™è˜­å¸å¦æ°´ <span class="tag tag-skin">é‚„åŸçœŸå¯¦</span></span><button onclick="buyItem('å¸å¦æ°´', 150, 'clean', 0)">$150</button></div>

        <hr>
        <h3>ğŸ’„ ç²¾ç·»å½©å¦å€</h3>
        <div class="item-card"><span>KATE ä¸‰è‰²çœ‰ç²‰ <span class="tag tag-makeup">+12</span></span><button onclick="buyItem('KATEçœ‰ç²‰', 240, 'makeup', 12)">$240</button></div>
        <div class="item-card"><span>ç¶“å…¸ç´…æ½¤å£ç´… <span class="tag tag-makeup">+20</span></span><button onclick="buyItem('å£ç´…', 200, 'makeup', 20)">$200</button></div>
    </div>

    <div id="inventory" class="section">
        <h3>ğŸ’ æˆ‘çš„èƒŒåŒ…</h3>
        <div id="inventory-display"></div>
    </div>

    <div id="diary" class="section">
        <h3>ğŸ““ è¯çµ¡ç°¿</h3>
        <textarea id="diary-box" oninput="saveDiary()" placeholder="ä»Šå¤©çš„å¿ƒæƒ…å¦‚ä½•ï¼Ÿ"></textarea>
    </div>
</div>

<script>
    const SAVE_KEY = "Tina_MagicShop_v3.5_Save";
    const ADMIN_USER = "tina0310", ADMIN_PASS = "0287901003";

    let state = { 
        money: 500, beauty: 80, hunger: 70, inventory: [], 
        makeupPoints: 0, // æ–°å¢ï¼šç´€éŒ„å½©å¦åŠ æˆ
        lastCheckIn: "", authorNote: "æ­¡è¿å›ä¾†ï¼Œåº—é•·ï¼", 
        diaryContent: "", hasReceivedGift: false,
        lastWashTime: Date.now(), isDirty: false, hasAcne: false
    };

    function saveGame() { localStorage.setItem(SAVE_KEY, JSON.stringify(state)); }
    function loadGame() {
        const saved = localStorage.getItem(SAVE_KEY);
        if (saved) state = Object.assign(state, JSON.parse(saved));
        document.getElementById('display-note').innerText = state.authorNote;
        document.getElementById('diary-box').value = state.diaryContent || "";
        updateUI();
    }

    // éŠæˆ²å¾ªç’°ï¼šè‡ªç„¶è¡°é€€
    setInterval(() => {
        // 1. é£½é£Ÿåº¦æ¶ˆè€—æ¸›ç·©
        if (state.hunger > 0) state.hunger -= 0.02; 
        
        // 2. é¡å€¼è‡ªç„¶è¡°é€€ (å‡ºæ²¹æš—æ²ˆ)
        state.beauty = Math.max(0, state.beauty - 0.01);
        
        // 3. è¶…é2å¤©ä¸æ´—é ­é¡å€¼å´©æ½° (2å¤© = 48å°æ™‚)
        let hoursSinceWash = (Date.now() - state.lastWashTime) / (1000 * 60 * 60);
        if (hoursSinceWash > 48) state.beauty = Math.max(0, state.beauty - 0.1);

        saveGame(); 
        updateUI();
    }, 2000);

    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if (id === 'inventory') renderInventory();
    }

    function buyItem(name, price, type, power) {
        if (state.money < price) { alert("é‡‘å¹£ä¸è¶³ï¼"); return; }
        state.money -= price;
        state.inventory.push({ name, type, power });
        saveGame(); updateUI("è³¼è²·äº† " + name);
    }

    function useItem(index) {
        const item = state.inventory[index];
        if (item.type === 'food') {
            state.hunger = Math.min(100, state.hunger + item.power);
        } else if (item.type === 'clean') {
            // å¸å¦ï¼šæ‰£é™¤å½©å¦åŠ æˆï¼Œæ¢å¾©çš®è†š
            state.beauty = Math.max(0, state.beauty - state.makeupPoints);
            state.makeupPoints = 0;
            state.isDirty = false;
            updateUI("å·²å¾¹åº•å¸å¦ï¼Œé¡å€¼å›æ­¸çœŸå¯¦ã€‚");
        } else if (item.type === 'makeup') {
            state.beauty = Math.min(100, state.beauty + item.power);
            state.makeupPoints += item.power; // ç´€éŒ„åŒ–äº†å¤šå°‘å¦
            state.isDirty = true;
        } else {
            state.beauty = Math.min(100, state.beauty + item.power);
        }
        state.inventory.splice(index, 1);
        saveGame(); renderInventory(); updateUI();
    }

    function renderInventory() {
        const div = document.getElementById('inventory-display');
        div.innerHTML = state.inventory.length === 0 ? "èƒŒåŒ…æ˜¯ç©ºçš„" : "";
        state.inventory.forEach((item, index) => {
            div.innerHTML += `<div class="item-card"><span>${item.name}</span><button onclick="useItem(${index})" style="background:#2ecc71">ä½¿ç”¨</button></div>`;
        });
    }

    function clickWork() { if (state.hunger >= 1) { state.money += 10; state.hunger -= 1; updateUI(); } else { alert("å¤ªé¤“äº†ï¼Œæ²’é«”åŠ›æ‰“å·¥ï¼"); } }
    function washHair() { state.lastWashTime = Date.now(); state.beauty = Math.min(100, state.beauty + 10); updateUI("æ´—é ­å®Œæˆï¼Œè®Šæ¸…çˆ½äº†ï¼"); }
    function checkIn() {
        const today = new Date().toLocaleDateString();
        if (state.lastCheckIn === today) alert("ä»Šå¤©ç°½éå›‰ï¼");
        else { state.money += 100; state.lastCheckIn = today; saveGame(); updateUI("ç°½åˆ°æˆåŠŸï¼é‡‘å¹£+100"); }
    }

    function updateUI(msg) {
        document.getElementById('money').innerText = Math.floor(state.money);
        document.getElementById('beauty').innerText = Math.floor(state.beauty);
        document.getElementById('hunger').innerText = Math.floor(state.hunger);
        if (msg) document.getElementById('status-display').innerText = msg;
        
        let hours = ((Date.now() - state.lastWashTime) / (1000 * 60 * 60)).toFixed(1);
        document.getElementById('last-wash-display').innerText = hours + " å°æ™‚å‰æ´—é ­";
        document.getElementById('skin-status-display').innerText = state.isDirty ? "ğŸ’„ å¸¶å¦ä¸­" : "ğŸŒ¿ ç´ é¡æ¸…çˆ½";
        
        let rank = "ç´ é¡æˆ°å£«";
        if (state.beauty > 90) rank = "âœ¨ æœƒè€ƒå¥³ç¥";
        else if (state.beauty > 70) rank = "ğŸ’„ ç²¾ç·»å¥³å­©";
        document.getElementById('beauty-rank').innerText = "é ­éŠœï¼š" + rank;
    }

    function toggleAdmin() { const p = document.getElementById('admin-panel'); p.style.display = (p.style.display === 'block' ? 'none' : 'block'); }
    function updateNote() {
        const u = document.getElementById('admin-user').value, p = document.getElementById('admin-pass').value;
        if (u === ADMIN_USER && p === ADMIN_PASS) {
            state.authorNote = document.getElementById('edit-note').value;
            document.getElementById('display-note').innerText = state.authorNote;
            saveGame(); toggleAdmin();
        } else alert("æ¬Šé™ä¸è¶³");
    }

    loadGame();
</script>
</body>
</html>
