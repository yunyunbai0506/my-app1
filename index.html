<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>æœƒè€ƒæˆ°å£«ï¼šç¥å¥‡è£œçµ¦ç¸½éƒ¨ v1.8.1</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f4f9; padding: 20px; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1, h2 { color: #333; text-align: center; }
        .stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; background: #eee; padding: 15px; border-radius: 10px; margin-bottom: 20px; font-weight: bold; text-align: center; }
        .menu { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; }
        button { padding: 10px 15px; cursor: pointer; border: none; border-radius: 8px; background: #6c5ce7; color: white; transition: 0.3s; }
        button:hover { background: #a29bfe; }
        .section { display: none; }
        .active { display: block; }
        .item-card { border: 1px solid #ddd; padding: 12px; margin: 10px 0; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
        .tag-food { background: #fab1a0; color: #d63031; font-size: 0.75em; padding: 2px 6px; border-radius: 4px; margin-left: 5px; }
        .status-msg { color: #e74c3c; font-weight: bold; text-align: center; min-height: 1.5em; margin-bottom: 10px; }
        #updateModal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border: 2px solid #6c5ce7; border-radius: 10px; z-index: 1000; box-shadow: 0 0 20px rgba(0,0,0,0.5); width: 80%; }
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); z-index: 999; }
        .auto-panel { background: #fffbe6; padding: 15px; border-radius: 10px; margin-top: 15px; border: 1px solid #ffe58f; }
    </style>
</head>
<body>

<div class="container">
    <h1 id="shop-name">ç¥å¥‡è£œçµ¦ç¸½éƒ¨</h1>
    <div id="status-display" class="status-msg">ç³»çµ±åˆå§‹åŒ–ä¸­...</div>

    <div class="stats">
        <div>ğŸ’° é‡‘å¹£<br><span id="money">500</span></div>
        <div>âœ¨ é¡å€¼<br><span id="beauty">80</span>/100</div>
        <div>ğŸ” é£½é£Ÿ<br><span id="hunger">70</span>/100</div>
    </div>

    <div class="menu">
        <button onclick="showSection('work')">è³ºéŒ¢ä¸­å¿ƒ</button>
        <button onclick="showSection('diary')">è¯çµ¡ç°¿</button>
        <button onclick="showSection('shop')">å•†åº—</button>
        <button onclick="toggleUpdateModal()">âœ¨ æ›´æ–°æ—¥èªŒ</button>
        <button onclick="clearSave()" style="background:#e74c3c">é‡ç½®å­˜æª”</button>
    </div>

    <div id="work" class="section active" style="text-align:center;">
        <div style="padding: 20px;">
            <button onclick="clickWork()" style="padding: 20px; font-size: 1.2em; background: #ff7675; width: 100%; font-weight: bold;">æ‰‹å‹•æ‰“å·¥ (é»æ“Š +10, é£½é£Ÿ -1)</button>
        </div>
        <div class="auto-panel">
            <h3>ğŸ¤– è‡ªå‹•åŒ–è¨­æ–½</h3>
            <div class="item-card"><span>è˜åƒ±å·¥è®€ç”Ÿ (æ¯ç§’ +1)</span><button onclick="buyAuto('helper', 300)">$300</button></div>
            <div class="item-card"><span>è‡ªå‹•çµå¸³æ©Ÿ (æ¯ç§’ +5)</span><button onclick="buyAuto('machine', 1000)">$1000</button></div>
        </div>
    </div>

    <div id="diary" class="section">
        <h2>ä»Šæ—¥è¯çµ¡ç°¿</h2>
        <textarea id="diary-box" style="width:100%; height:150px; border-radius:10px; padding:10px;" placeholder="å¯«ä¸‹æ˜å¤©çš„è¦åŠƒ..."></textarea>
    </div>

    <div id="shop" class="section">
        <h2>ç¥å¥‡å•†åº—</h2>
        <h3 style="border-left: 5px solid #fab1a0; padding-left: 10px;">ğŸ ç¾é£Ÿè¡—</h3>
        <div class="item-card"><span>æ‡‰æ€¥åå¸ <span class="tag-food">é£½é£Ÿ+20</span></span><button onclick="eat('åå¸', 50, 20)">$50</button></div>
        <div class="item-card"><span>èƒ½é‡é£²æ–™ <span class="tag-food">é£½é£Ÿ+40</span></span><button onclick="eat('é£²æ–™', 120, 40)">$120</button></div>
        
        <h3 style="border-left: 5px solid #6c5ce7; padding-left: 10px; margin-top:20px;">ğŸ’„ ç¾å¦ä¿é¤Š</h3>
        <div class="item-card"><span>é­…æƒ‘å£ç´… (éœ€å¸å¦)</span><button onclick="buy('å£ç´…', 200, 15, true)">$200</button></div>
        <div class="item-card"><span>æ›¼ç§€é›·æ•¦èª¿ç†æ°´</span><button onclick="buy('èª¿ç†æ°´', 120, 8, false)">$120</button></div>
        <div class="item-card"><span>é›ªèŠ™è˜­å¸å¦æ°´</span><button onclick="buy('å¸å¦', 150, 0, false)">$150</button></div>
        <div class="item-card"><span>å¯ç«‹ä¿¡ç—˜ç—˜å‡è† </span><button onclick="buy('ç—˜ç—˜è†', 200, 0, false)">$200</button></div>
    </div>
</div>

<div id="overlay" onclick="toggleUpdateModal()"></div>
<div id="updateModal">
    <h3>ğŸš€ v1.8.1 é‚è¼¯æ ¡å°ç‰ˆ</h3>
    <hr>
    <ul>
        <li>[æ ¡æ­£] ä¿®æ­£é£½é£Ÿåº¦é¡¯ç¤ºå°æ•¸é»çš„å•é¡Œã€‚</li>
        <li>[æ ¡æ­£] å¼·åŒ– LocalStorage å­˜æª”è®€å–é †åºã€‚</li>
        <li>[åŠŸèƒ½] é£½é£Ÿåº¦æ­¸é›¶æ¯ç§’æ‰£ 1 é¡å€¼ï¼Œæ‰“å·¥éœ€æ¶ˆè€—é£½é£Ÿã€‚</li>
        <li>[åŠŸèƒ½] è‡ªå‹•è³ºéŒ¢åœ¨åˆ‡æ›åˆ†é æ™‚ä¾ç„¶æœ‰æ•ˆã€‚</li>
    </ul>
    <button onclick="toggleUpdateModal()">é—œé–‰</button>
</div>

<script>
    // é è¨­åˆå§‹ç‹€æ…‹
    let state = {
        money: 500,
        beauty: 80,
        hunger: 70,
        autoIncome: 0,
        isDirty: false,
        hasAcne: false
    };

    const max = 100;

    // --- æ ¸å¿ƒåŠŸèƒ½ï¼šå­˜æª”/è®€æª” ---
    function saveGame() {
        localStorage.setItem('magicShopSave_v1', JSON.stringify(state));
    }

    function loadGame() {
        const savedData = localStorage.getItem('magicShopSave_v1');
        if (savedData) {
            try {
                const parsed = JSON.parse(savedData);
                state = Object.assign(state, parsed); // åˆä½µæ•¸æ“šç¢ºä¿å®Œæ•´
                updateUI("æ­¡è¿å›ä¾†ï¼Œé€²åº¦å·²è¼‰å…¥ã€‚");
            } catch (e) {
                console.error("è®€æª”å¤±æ•—");
            }
        }
    }

    function clearSave() {
        if(confirm("ç¢ºå®šè¦é‡ç½®æ‰€æœ‰æ•¸æ“šå—ï¼Ÿ")) {
            localStorage.removeItem('magicShopSave_v1');
            location.reload();
        }
    }

    // --- æ ¸å¿ƒåŠŸèƒ½ï¼šå®šæ™‚å™¨ (æ¯ä¸€ç§’åŸ·è¡Œä¸€æ¬¡) ---
    setInterval(() => {
        // 1. è‡ªå‹•æ”¶å…¥
        state.money += state.autoIncome;
        
        // 2. è‡ªå‹•é£¢é¤“ (æ¯ç§’ -0.5)
        if (state.hunger > 0) {
            state.hunger -= 0.5;
        } else {
            // 3. é£¢é¤“æ‡²ç½°ï¼šæ¯ç§’ -1 é¡å€¼
            state.beauty = Math.max(0, state.beauty - 1);
        }
        
        saveGame();
        updateUI();
    }, 1000);

    // --- ä»‹é¢åˆ‡æ› ---
    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        // åªæœ‰å¸¶å¦æ™‚åˆ‡æ›åˆ†é æ‰æœƒæœ‰æ©Ÿç‡é•·ç—˜
        if (state.isDirty) checkAcneRisk();
    }

    function toggleUpdateModal() {
        const m = document.getElementById('updateModal');
        const o = document.getElementById('overlay');
        const isShow = m.style.display === 'block';
        m.style.display = isShow ? 'none' : 'block';
        o.style.display = isShow ? 'none' : 'block';
    }

    // --- éŠæˆ²å‹•ä½œ ---
    function clickWork() {
        if (state.hunger < 1) {
            alert("ä½ å·²ç¶“é¤“æ˜äº†ï¼Œæ²’è¾¦æ³•æ‰“å·¥ï¼å¿«å»ç¾é£Ÿè¡—ã€‚");
            return;
        }
        state.money += 10;
        state.hunger = Math.max(0, state.hunger - 1);
        saveGame();
        updateUI("åŠªåŠ›æ‰“å·¥ä¸­ (+10ğŸ’°, -1ğŸ”)");
    }

    function buyAuto(type, price) {
        if (state.money >= price) {
            state.money -= price;
            state.autoIncome += (type === 'helper' ? 1 : 5);
            saveGame();
            updateUI("è¨­å‚™å‡ç´šæˆåŠŸï¼");
        } else alert("é‡‘å¹£ä¸è¶³ï¼Œç„¡æ³•è³¼è²·è‡ªå‹•åŒ–è¨­å‚™ã€‚");
    }

    function eat(name, price, gain) {
        if (state.money < price) { alert("ä½ å¤ªçª®äº†ï¼Œè²·ä¸èµ·é€™é “é£¯ã€‚"); return; }
        if (state.hunger >= max) { alert("ä½ å·²ç¶“é£½åˆ°åƒä¸ä¸‹äº†ã€‚"); return; }
        state.money -= price;
        state.hunger = Math.min(max, state.hunger + gain);
        saveGame();
        updateUI("äº«ç”¨äº†" + name + "ï¼Œé£½é£Ÿåº¦ä¸Šå‡ï¼");
    }

    function buy(name, price, gain, makeup) {
        if (state.money < price) { alert("éŒ¢ä¸å¤ å–”ï¼"); return; }
        
        if (name === 'å¸å¦') {
            state.money -= price;
            state.isDirty = false;
            updateUI("å¦å®¹å¸é™¤ä¹¾æ·¨äº†ï¼Œçš®è†šå¥½èˆ’æœï¼");
        } else if (name === 'ç—˜ç—˜è†') {
            if (state.hasAcne) {
                state.money -= price;
                state.hasAcne = false;
                state.beauty = Math.min(max, state.beauty + 15);
                updateUI("æ“¦äº†è—¥ï¼Œç—˜ç—˜æ…¢æ…¢æ¶ˆå¤±äº†ã€‚");
            } else alert("ä½ è‡‰ä¸Šå¾ˆä¹¾æ·¨ï¼Œä¸éœ€è¦æ“¦è—¥ã€‚");
        } else {
            state.money -= price;
            state.beauty = Math.min(max, state.beauty + gain);
            if (makeup) state.isDirty = true;
            updateUI("ä½¿ç”¨äº† " + name + (makeup ? " (è¨˜å¾—å¸å¦)" : ""));
        }
        saveGame();
    }

    function checkAcneRisk() {
        if (state.isDirty && Math.random() < 0.2) {
            state.hasAcne = true;
            state.beauty = Math.max(0, state.beauty - 10);
            updateUI("âš ï¸ æ²’å¸å¦å°±è·‘ä¾†è·‘å»ï¼Œé•·ç—˜ç—˜äº†ï¼");
        }
    }

    function updateUI(msg) {
        // é¡¯ç¤ºæ™‚ä½¿ç”¨ Math.floor é¿å…å°æ•¸é»äº‚è·‘
        document.getElementById('money').innerText = Math.floor(state.money);
        document.getElementById('beauty').innerText = Math.floor(state.beauty);
        document.getElementById('hunger').innerText = Math.floor(state.hunger);
        
        let statusText = msg || `è‡ªå‹•ç”¢é‡‘ä¸­ï¼š${state.autoIncome}/ç§’`;
        if (state.hunger <= 0) statusText = "â— è­¦å‘Šï¼šé£¢é¤“éåº¦ï¼Œé¡å€¼æŒçºŒä¸‹é™ä¸­ï¼";
        
        document.getElementById('status-display').innerText = statusText;
        if (state.hasAcne) document.getElementById('status-display').innerText += " [ğŸ¦  ç—˜ç—˜ä¸­]";
    }

    // åˆå§‹åŒ–è¼‰å…¥
    loadGame();
    updateUI();
</script>
</body>
</html>
